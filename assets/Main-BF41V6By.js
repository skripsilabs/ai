import{c as V,e as pe,l as be,f as ge,G as je,h as we,M as ve,F as ye,C as Ne,r as n,j as e,B as ce,R as de}from"./index-BWNcYAeT.js";import{S as ke,M as Se}from"./SidebarKiri-Bh1Y3lyH.js";import{C as _e}from"./copy-D-HFe9fe.js";import{S as Z}from"./send-DzIQWu3d.js";import{T as Ie}from"./trash-2-CFal7QXv.js";import{T as le}from"./triangle-alert-CjdEvnMs.js";import{P as Ce,A as W,L as ue}from"./config-D-SuQaUu.js";import{E as re}from"./external-link-HIusKmqF.js";import{G as U}from"./globe-Cjc3YA-1.js";import{I as De,S as $e}from"./school-aU2A8634.js";import{L as X}from"./loader-circle-D3RW74a9.js";import{U as ie}from"./users-WWCFTvlX.js";import{X as F}from"./x-9_K5FFx2.js";import{S as Q}from"./search-DFAG4gq_.js";import{B as Ae}from"./book-open-C18M9zRz.js";import{U as ze}from"./user-CoqcEk46.js";import{S as Re}from"./sparkles-BlfXn-mM.js";import"./message-square-text-fQR6H1c9.js";import"./check-Ma8MJNWC.js";import"./heart-BDFZdT5H.js";import"./download-COldOw2r.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=V("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=V("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=V("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=V("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=V("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=V("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=V("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);async function Me(s){const{history:i,newMessage:o,metadata:a,userName:c}=s,b=pe();if(b.length===0)throw new Error("API Key hilang. Mohon cek .env.local.");be("CHAT STREAM");const z="Alin (Teman Diskusi Skripsi)",D=`USER: ${c} (Panggil dia dengan nama ini!).
DATA SKRIPSI USER (Bahan diskusi):
${ge(a)}`,x=`${`
    INFORMASI PENCIPTA:
    Dikembangkan oleh AlinLabs Indonesia di bawah visi Mr. ${ye.nama}.
    `}

${Ne}

INSTRUKSI KHUSUS: Selalu panggil user dengan nama "${c}" agar lebih akrab.`,$=we(z,D,x),T=i.map(f=>({role:f.role==="model"?"model":"user",parts:[{text:f.text}]}));for(const f of b)try{console.log(`[AI] Mencoba dengan Key: ...${f.slice(-4)}`);const A=await new je({apiKey:f}).chats.create({model:ve,history:T,config:{temperature:.8,systemInstruction:$}}).sendMessageStream({message:o});return{async*[Symbol.asyncIterator](){for await(const M of A)M.text&&(yield{text:M.text})}}}catch(g){console.warn(`[AI] Key ...${f.slice(-4)} gagal:`,g.message)}throw console.error("[SkripsiLab] All API Keys Failed."),new Error("CRITICAL_SERVER_DOWN")}const ne="https://imgur.com/bH0YM3s.png",Le=()=>e.jsxs("div",{className:"flex gap-3 animate-slide-up-fade pb-2 mt-4 items-start w-full",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 border border-red-200 flex items-center justify-center shrink-0 shadow-sm overflow-hidden mb-1",children:e.jsx(le,{size:16,className:"text-red-500"})}),e.jsxs("div",{className:"px-5 py-4 bg-red-50 border border-red-100 rounded-2xl rounded-tl-sm shadow-sm w-full max-w-sm",children:[e.jsx("h3",{className:"font-bold text-red-600 text-sm mb-1",children:"Server Ai sedang tidak bisa di gunakan"}),e.jsx("p",{className:"text-xs text-red-500 mb-3 leading-relaxed",children:"Terjadi gangguan pada koneksi ke otak AI. Silakan hubungi pengembang untuk perbaikan segera."}),e.jsxs("a",{href:"https://wa.me/6285797184059?text=Halo%20Developer,%20saya%20mengalami%20masalah%20Server%20Down%20di%20SkripsiLab.",target:"_blank",rel:"noopener noreferrer",className:"block bg-white rounded-xl overflow-hidden border border-red-200 hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"h-24 bg-[#25D366] flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx(Ce,{size:32,className:"text-white relative z-10"}),e.jsx("div",{className:"absolute top-2 right-2 bg-white/20 backdrop-blur-md p-1 rounded-full text-white",children:e.jsx(re,{size:12})})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 mb-1",children:"Hubungi Developer"}),e.jsx("p",{className:"text-[10px] text-slate-500 line-clamp-2",children:"Klik untuk terhubung langsung via WhatsApp (+6285797184059) dan laporkan kendala sistem."}),e.jsxs("div",{className:"text-[9px] mt-2 text-slate-400 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(U,{size:10})," wa.me"]})]})]})]})]}),Be=()=>e.jsxs("div",{className:"flex gap-3 animate-slide-up-fade pb-2 items-end",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center shrink-0 shadow-sm overflow-hidden mb-1",children:e.jsx("img",{src:ne,alt:"Alin",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"px-4 py-3 bg-white border border-slate-200 rounded-2xl rounded-bl-md shadow-sm flex items-center gap-1.5 h-[40px]",children:[e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-300"})]})]}),ee=s=>{const i=new Date(s),o=new Date,a=new Date(o);return a.setDate(a.getDate()-1),i.toDateString()===o.toDateString()?"Hari Ini":i.toDateString()===a.toDateString()?"Kemarin":i.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})},Ke=n.memo(({text:s})=>{const i=s.split(`
`);return e.jsx("div",{className:"prose-chat text-sm leading-relaxed whitespace-pre-wrap",children:i.map((o,a)=>o.trim().startsWith("- ")?e.jsx("li",{className:"ml-2",children:te(o.substring(2))},a):/^\d+\.\s/.test(o.trim())?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-bold min-w-[15px]",children:[o.split(".")[0],"."]}),e.jsx("span",{children:te(o.replace(/^\d+\.\s/,""))})]},a):o.startsWith("```")?null:o.trim().length===0?e.jsx("div",{className:"h-2"},a):e.jsx("div",{children:te(o)},a))})}),te=s=>{const i=/(\*\*[^*]+\*\*|\*[^*]+\*|`[^`]+`|\[[^\]]+\]\([^)]+\))/g;return s.split(i).map((a,c)=>{if(a.startsWith("[")&&a.includes("](")&&a.endsWith(")")){const b=a.match(/\[([^\]]+)\]\(([^)]+)\)/);if(b)return e.jsxs("a",{href:b[2],target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 font-bold hover:underline inline-flex items-center gap-1 bg-blue-50 px-1 rounded hover:bg-blue-100 transition-colors",children:[b[1]," ",e.jsx(re,{size:10,className:"mb-0.5"})]},c)}return a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{className:"text-slate-900",children:a.slice(2,-2)},c):a.startsWith("*")&&a.endsWith("*")?e.jsx("em",{children:a.slice(1,-1)},c):a.startsWith("`")&&a.endsWith("`")?e.jsx("code",{className:"bg-slate-100 px-1 py-0.5 rounded text-xs border border-slate-200 text-pink-600 font-mono",children:a.slice(1,-1)},c):a})},Oe=({metadata:s,currentUser:i,initialMessage:o,onMessageConsumed:a,onStatusChange:c})=>{var u,j,I;const[b,z]=n.useState(()=>{const l=localStorage.getItem("skripsi_chat_history");return l?JSON.parse(l):[]}),[D,w]=n.useState(""),[x,$]=n.useState(!1),[T,f]=n.useState(!1),g=n.useRef(null),h=n.useRef(null),[A,M]=n.useState(!1),N=n.useRef(null),_=((j=(u=i==null?void 0:i.identitas)==null?void 0:u.nama)==null?void 0:j.split(" ")[0])||((I=s.author)==null?void 0:I.split(" ")[0])||"Teman";n.useEffect(()=>{localStorage.setItem("skripsi_chat_history",JSON.stringify(b)),A||setTimeout(R,50)},[b,T]),n.useEffect(()=>{c(b.length>0?"online":"offline")},[]),n.useEffect(()=>{o&&!x&&(E(o),a&&a())},[o]);const R=()=>{var l;(l=g.current)==null||l.scrollIntoView({behavior:"smooth"})},L=()=>{if(!h.current)return;const{scrollTop:l,scrollHeight:k,clientHeight:y}=h.current,r=Math.abs(k-y-l)<100;M(!r)},E=async l=>{var y,r,t,d,m;if(!l.trim()||x)return;navigator.vibrate&&navigator.vibrate(30);const k={id:Date.now().toString(),role:"user",text:l,timestamp:Date.now()};z(S=>[...S,k]),$(!0),c("typing"),w(""),f(!0),M(!1),N.current=new AbortController;try{const S=b.length>15?b.slice(-15):b,p=await Me({history:S,newMessage:k.text,metadata:s,userName:_});let C="";for await(const P of p){if((y=N.current)!=null&&y.signal.aborted)break;P.text&&(C+=P.text)}if(C&&!((r=N.current)!=null&&r.signal.aborted)){const P=C.split("<<<SPLIT>>>").map(B=>B.trim()).filter(B=>B);for(let B=0;B<P.length&&!((t=N.current)!=null&&t.signal.aborted);B++){f(!0),c("typing"),R();const J=1e3+Math.min(P[B].length*10,1500);if(await new Promise(G=>setTimeout(G,J)),(d=N.current)!=null&&d.signal.aborted)break;f(!1),navigator.vibrate&&navigator.vibrate(15),z(G=>[...G,{id:`${Date.now()}-${B}`,role:"model",text:P[B],timestamp:Date.now()}]),B<P.length-1&&await new Promise(G=>setTimeout(G,300))}}c("online")}catch(S){if((m=N.current)!=null&&m.signal.aborted){c("online");return}f(!1),S.message.includes("CRITICAL_SERVER_DOWN")?z(p=>[...p,{id:Date.now().toString(),role:"model",text:"ERROR_UI_SERVER_DOWN",timestamp:Date.now()}]):z(p=>[...p,{id:Date.now().toString(),role:"model",text:`⚠️ Gangguan sinyal nih. ${S.message}`,timestamp:Date.now()}]),c("online")}finally{$(!1),f(!1),N.current=null}},v=()=>{N.current&&(N.current.abort(),$(!1),f(!1),c("online"),navigator.vibrate&&navigator.vibrate(30))},K=()=>{confirm("Hapus histori chat?")&&(z([]),localStorage.removeItem("skripsi_chat_history"),c("offline"))};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none overflow-hidden",children:e.jsx(ce,{className:"w-[400px] h-[400px] opacity-[0.02]"})}),e.jsxs("div",{ref:h,onScroll:L,className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-1 scroll-light relative z-10 scroll-smooth",children:[b.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-8 opacity-60 animate-fade-in-up",children:[e.jsx("div",{className:"w-24 h-24 bg-white rounded-full shadow-lg border-4 border-white flex items-center justify-center mb-6 overflow-hidden",children:e.jsx("img",{src:ne,alt:"Alin",className:"w-full h-full object-cover"})}),e.jsxs("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:["Halo ",_,"! Aku Alin."]}),e.jsx("p",{className:"text-slate-500 max-w-md leading-relaxed text-sm",children:"Teman diskusi skripsimu. Mau bahas apa?"})]}):b.map((l,k)=>{if(l.text==="ERROR_UI_SERVER_DOWN")return e.jsx(Le,{},l.id);const y=b[k-1],r=y&&y.role===l.role&&l.timestamp-y.timestamp<12e4,t=!y||ee(l.timestamp)!==ee(y.timestamp);return e.jsxs(de.Fragment,{children:[t&&e.jsx("div",{className:"flex justify-center my-6 sticky top-0 z-10",children:e.jsx("span",{className:"bg-slate-200/80 backdrop-blur text-slate-500 text-[10px] font-bold px-3 py-1 rounded-full shadow-sm border border-white/50",children:ee(l.timestamp)})}),e.jsxs("div",{className:`flex gap-3 animate-slide-up-fade ${r?"mt-1":"mt-4"} ${l.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm overflow-hidden border ${r?"invisible":""} ${l.role==="user"?"bg-slate-200 border-slate-300":"bg-white border-slate-200"}`,children:l.role==="user"?e.jsx("span",{className:"font-bold text-slate-500 text-xs",children:_.substring(0,2).toUpperCase()}):e.jsx("img",{src:ne,alt:"Alin",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:`max-w-[85%] md:max-w-[75%] px-4 py-3 text-sm shadow-sm relative group transition-all duration-300 ${l.role==="user"?"bg-slate-900 text-white rounded-2xl rounded-tr-sm":"bg-white border border-slate-200 text-slate-800 rounded-2xl rounded-tl-sm"}`,children:[l.role==="model"?e.jsx(Ke,{text:l.text}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:l.text}),e.jsxs("div",{className:`flex items-center gap-2 mt-1.5 opacity-0 group-hover:opacity-100 transition-opacity justify-end ${l.role==="user","text-slate-400"}`,children:[e.jsx("span",{className:"text-[10px]",children:new Date(l.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(l.text),alert("Teks disalin")},className:"hover:text-blue-500 transition-colors",children:e.jsx(_e,{size:10})})]})]})]})]},l.id)}),T&&e.jsx(Be,{}),e.jsx("div",{ref:g,className:"h-4"})]}),A&&e.jsx("div",{className:"absolute bottom-24 right-6 z-20 animate-bounce",children:e.jsx("button",{onClick:R,className:"p-2 bg-white text-slate-600 rounded-full shadow-lg border border-slate-200 hover:bg-slate-50 transition-all",children:e.jsx(me,{size:20})})}),e.jsxs("div",{className:"w-full p-4 md:p-6 bg-white/80 backdrop-blur-xl border-t border-slate-200 relative z-20 pb-safe",children:[b.length===0&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-3 no-scrollbar mb-2 justify-center",children:["Buatkan outline skripsi","Cari judul tentang AI","Apa itu kualitatif?","Parafrase teks ini"].map(l=>e.jsx("button",{onClick:()=>E(l),className:"px-4 py-2 bg-slate-100 hover:bg-blue-50 text-slate-600 hover:text-blue-600 rounded-full text-xs font-bold transition-all border border-slate-200 whitespace-nowrap",children:l},l))}),e.jsxs("div",{className:"max-w-4xl mx-auto flex items-end gap-2 bg-white border border-slate-300 p-2 pr-2 rounded-[26px] shadow-lg shadow-slate-200/50 focus-within:ring-4 focus-within:ring-blue-500/10 focus-within:border-blue-400 transition-all",children:[e.jsx("textarea",{value:D,onChange:l=>w(l.target.value),onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),E(D))},placeholder:"Ketik pesan...",className:"flex-1 max-h-32 min-h-[44px] bg-transparent border-none focus:ring-0 resize-none py-3 px-4 text-sm md:text-base text-slate-800 placeholder:text-slate-400 no-scrollbar",rows:1,disabled:x,style:{height:"auto"},onInput:l=>{const k=l.target;k.style.height="auto",k.style.height=`${Math.min(k.scrollHeight,128)}px`}}),x?e.jsx("button",{onClick:v,className:"w-10 h-10 flex items-center justify-center rounded-full bg-slate-200 text-slate-500 hover:text-red-500 hover:bg-red-50 transition-all mb-[2px]",children:e.jsx(Pe,{size:14,fill:"currentColor"})}):e.jsx("button",{onClick:()=>E(D),disabled:!D.trim(),className:"w-10 h-10 flex items-center justify-center rounded-full bg-[#0A1A2E] text-white hover:bg-blue-900 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md mb-[2px] active:scale-90",children:e.jsx(Z,{size:18,className:"ml-0.5"})})]}),e.jsxs("div",{className:"text-center mt-3 flex justify-between items-center px-2",children:[e.jsx("p",{className:"text-[9px] text-slate-400",children:"AI dapat membuat kesalahan. Cek kembali informasi penting."}),b.length>0&&e.jsxs("button",{onClick:K,className:"text-[10px] text-slate-400 hover:text-red-500 flex items-center gap-1 transition-colors",children:[e.jsx(Ie,{size:10})," Hapus Chat"]})]})]})]})},se=/(https?:\/\/[^\s]+)/g,fe=({text:s,isMe:i,hideText:o=!1})=>{const[a,c]=n.useState(null),[b,z]=n.useState(!1),D=s.match(se),w=D?D[0]:null;n.useEffect(()=>{w&&x(w)},[w]);const x=async T=>{z(!0);try{const g=await(await fetch(`${W}/meta?url=${encodeURIComponent(T)}`)).json();(g.title||g.image)&&c(g)}catch(f){console.error("Meta fetch failed",f)}finally{z(!1)}},$=T=>T.split(se).map((g,h)=>g.match(se)?e.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",className:`hover:underline font-medium break-all ${i?"text-blue-100":"text-[#3EC1FF]"}`,children:g},h):e.jsx("span",{children:g},h));return w?e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[!o&&e.jsx("span",{className:"break-words whitespace-pre-wrap",children:$(s)}),(a||b)&&e.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:`block mt-1 rounded-xl overflow-hidden transition-all duration-300 group hover:shadow-md ${i?"bg-black/10 border border-white/10":"bg-slate-50 border-l-4 border-[#3EC1FF]"}`,children:b?e.jsxs("div",{className:"p-3 flex items-center gap-2 text-xs opacity-70",children:[e.jsx(U,{size:12,className:"animate-spin"})," Memuat preview..."]}):a&&e.jsxs(e.Fragment,{children:[a.image?e.jsxs("div",{className:"h-32 w-full overflow-hidden bg-slate-200 relative",children:[e.jsx("img",{src:a.image,alt:"Preview",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:T=>{T.target.style.display="none"}}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/50 backdrop-blur-sm p-1 rounded-full text-white",children:e.jsx(re,{size:12})})]}):e.jsx("div",{className:"h-20 w-full bg-slate-100 flex items-center justify-center",children:e.jsx(De,{className:"text-slate-300",size:24})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:`text-xs font-bold line-clamp-1 mb-1 ${i?"text-white":"text-[#0A1A2E]"}`,children:a.title||w}),e.jsx("p",{className:`text-[10px] line-clamp-2 leading-relaxed ${i?"text-blue-100":"text-slate-500"}`,children:a.description||"Klik untuk mengunjungi tautan ini."}),e.jsxs("div",{className:`text-[9px] mt-2 opacity-60 uppercase tracking-wider flex items-center gap-1 ${i?"text-blue-200":"text-slate-400"}`,children:[e.jsx(U,{size:10})," ",new URL(w).hostname]})]})]})})]}):o?null:e.jsx("span",{className:"break-words whitespace-pre-wrap",children:s})},He=["tolol","bego","goblok","anjing","bangsat","kontol","memek","jembut","ngentot","babi","monyet","kunyuk","bajingan","asu","tai","idiot","sarap","gila","dungu","kampret","keparat","bejad","biadab"],q={STRIKES:"skripsi_mod_strikes",BAN_UNTIL:"skripsi_mod_ban_until"},H={checkContent:s=>{const i=s.toLowerCase(),o=He.find(a=>new RegExp(`\\b${a}\\b`,"i").test(i)||i.includes(a));return o?{isSafe:!1,reason:`Terdeteksi kata kasar/ujaran kebencian: "${o}".`}:{isSafe:!0}},handleViolation:()=>{const i=parseInt(localStorage.getItem(q.STRIKES)||"0")+1;if(localStorage.setItem(q.STRIKES,i.toString()),i>=2){const a=Date.now()+6e4;return localStorage.setItem(q.BAN_UNTIL,a.toString()),localStorage.setItem(q.STRIKES,"0"),"ANDA DISKORS 60 DETIK! Ini adalah pelanggaran kedua. Anda tidak dapat mengirim pesan untuk sementara waktu."}else return"PERINGATAN KERAS! [1/2] Kata-kata kasar melanggar Terms of Service. Jika Anda mengulangi sekali lagi, akun Anda akan diskors (mute) selama 60 Detik."},isBanned:()=>{const s=parseInt(localStorage.getItem(q.BAN_UNTIL)||"0");return s>Date.now()?{banned:!0,remaining:s-Date.now()}:(s!==0&&localStorage.removeItem(q.BAN_UNTIL),{banned:!1})},formatTimeLeft:s=>{const i=Math.ceil(s/1e3);if(i<60)return`${i} detik`;const o=Math.floor(i/60),a=i%60;return`${o} menit ${a} detik`}},ae=s=>{const i=new Date(s),o=new Date,a=new Date(o);return a.setDate(a.getDate()-1),i.toDateString()===o.toDateString()?"Hari Ini":i.toDateString()===a.toDateString()?"Kemarin":i.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})},We=({currentUser:s})=>{const[i,o]=n.useState([]),[a,c]=n.useState(""),[b,z]=n.useState(!0),[D,w]=n.useState(!1),[x,$]=n.useState(null),[T,f]=n.useState(!1),[g,h]=n.useState({banned:!1}),[A,M]=n.useState(!1),[N,_]=n.useState(0),R=n.useRef(0),L=n.useRef(null),E=n.useRef(null),v=n.useRef(null),K=n.useRef(null),u=n.useRef(!1);n.useEffect(()=>{h(H.isBanned()),k(!0);const r=()=>{v.current&&clearInterval(v.current),v.current=setInterval(()=>k(!1),2e3)},t=()=>{document.hidden?v.current&&clearInterval(v.current):(k(!1),r())};document.addEventListener("visibilitychange",t),r();const d=setInterval(()=>{const m=Date.now()-864e5;o(S=>S.filter(p=>p.created_at>m))},6e4);return()=>{v.current&&clearInterval(v.current),clearInterval(d),document.removeEventListener("visibilitychange",t)}},[]),n.useEffect(()=>{if(a){const r=a.match(/(https?:\/\/[^\s]+)/);if(r){const t=r[0];K.current&&clearTimeout(K.current),(!x||x.url!==t)&&(K.current=setTimeout(()=>j(t),800))}else f(!1),$(null)}else f(!1),$(null)},[a]);const j=async r=>{try{const d=await(await fetch(`${W}/meta?url=${encodeURIComponent(r)}`)).json();d.title&&($(d),f(!0))}catch{}};n.useEffect(()=>{u.current?i.length>0:I()},[i]);const I=()=>{var r;(r=L.current)==null||r.scrollIntoView({behavior:"smooth"}),_(0)},l=()=>{if(!E.current)return;const{scrollTop:r,scrollHeight:t,clientHeight:d}=E.current,m=Math.abs(t-d-r)<100;u.current=!m,M(!m),m&&_(0)},k=async(r=!1)=>{if(!(document.hidden&&!r))try{let t=`${W}/chat`;!r&&R.current>0&&(t+=`?after=${R.current}`);const m=await(await fetch(t)).json();if(m.results&&m.results.length>0){const S=m.results,p=S[S.length-1];p.created_at>R.current&&(R.current=p.created_at),o(C=>{const P=C.filter(O=>!O.isPending),B=new Set(P.map(O=>O.id)),J=Date.now()-24*60*60*1e3,G=[...P,...S.filter(O=>!B.has(O.id)&&O.created_at>J)];return u.current&&S.length>0&&_(O=>O+S.length),G})}}catch{}finally{r&&z(!1)}},y=async()=>{if(!s)return alert("Harap login.");const r=H.isBanned();if(r.banned)return h(r);if(!a.trim())return;const t=H.checkContent(a);if(!t.isSafe){const p=H.handleViolation();alert(`${t.reason}

${p}`);const C=H.isBanned();h(C),C.banned&&c("");return}const d=Date.now(),m={id:d,user_id:s.verifikasi.id_akun,user_name:s.identitas.nama,message:a,created_at:Date.now(),isPending:!0};o(p=>[...p,m]);const S=a;c(""),$(null),f(!1),w(!0),u.current=!1;try{await fetch(`${W}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:s.verifikasi.id_akun,user_name:s.identitas.nama,message:S})}),k(!1)}catch{alert("Gagal mengirim."),o(C=>C.filter(P=>P.id!==d)),c(S)}finally{w(!1)}};return e.jsxs("div",{className:"flex flex-col h-full bg-[#e5ddd5]/10 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] relative",children:[e.jsx("div",{className:"bg-blue-50/80 p-2 text-center border-b border-blue-100 flex-none backdrop-blur-md sticky top-0 z-10 shadow-sm",children:e.jsxs("p",{className:"text-[10px] text-blue-600 font-bold flex items-center justify-center gap-1 uppercase tracking-wider",children:[e.jsx(le,{size:10})," Pesan hilang otomatis dalam 24 jam"]})}),e.jsxs("div",{ref:E,onScroll:l,className:"flex-1 overflow-y-auto p-4 space-y-1 scroll-light pt-2",children:[b&&i.length===0?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(X,{className:"animate-spin text-blue-500",size:32})}):i.length===0?e.jsxs("div",{className:"text-center py-20 text-slate-400",children:[e.jsx(ie,{size:48,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Jadilah yang pertama menulis di sini!"})]}):i.map((r,t)=>{const d=s&&r.user_id===s.verifikasi.id_akun,m=i[t-1],p=m&&m.user_id===r.user_id&&r.created_at-m.created_at<12e4,C=!m||ae(r.created_at)!==ae(m.created_at);return e.jsxs(de.Fragment,{children:[C&&e.jsx("div",{className:"flex justify-center my-4 sticky top-2 z-0",children:e.jsx("span",{className:"bg-slate-200/80 backdrop-blur-md text-slate-600 text-[10px] font-bold px-3 py-1 rounded-full shadow-sm border border-white/50",children:ae(r.created_at)})}),e.jsx("div",{className:`flex flex-col ${d?"items-end":"items-start"} ${p?"mt-0.5":"mt-3"} animate-slide-up-fade`,children:e.jsxs("div",{className:`flex items-end gap-2 max-w-[85%] md:max-w-[70%] ${d?"flex-row-reverse":"flex-row"}`,children:[!d&&e.jsx("div",{className:`w-8 h-8 shrink-0 ${p?"invisible":""}`,children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-white flex items-center justify-center text-[10px] font-bold shadow-sm border border-slate-200 text-slate-600",children:r.user_name?r.user_name.substring(0,2).toUpperCase():"AN"})}),e.jsxs("div",{className:`
                                        flex flex-col min-w-0 
                                        ${d?"items-end":"items-start"}
                                    `,children:[!d&&!p&&e.jsx("span",{className:"text-[10px] font-bold text-slate-500 ml-2 mb-0.5",children:r.user_name}),e.jsxs("div",{className:`
                                            px-3 py-2 text-sm leading-relaxed shadow-sm break-words relative group transition-all w-full
                                            ${d?`bg-blue-600 text-white ${p?"rounded-2xl rounded-tr-md":"rounded-2xl rounded-tr-none"}`:`bg-white border border-slate-200 text-slate-800 ${p?"rounded-2xl rounded-tl-md":"rounded-2xl rounded-tl-none"}`} 
                                            ${r.isPending?"opacity-70":""}
                                        `,children:[e.jsx(fe,{text:r.message,isMe:d}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 opacity-70 justify-end text-[9px] ${d?"text-blue-100":"text-slate-400"}`,children:[r.isPending&&e.jsx(xe,{size:8}),e.jsx("span",{children:new Date(r.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]})]})})]},r.id)}),e.jsx("div",{ref:L,className:"h-2"})]}),A&&e.jsx("div",{className:"absolute bottom-24 right-4 z-30 animate-bounce",children:e.jsxs("button",{onClick:I,className:"p-2 bg-white text-blue-600 rounded-full shadow-lg border border-slate-200 hover:bg-blue-50 transition-all relative",children:[e.jsx(me,{size:20}),N>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center border-2 border-white",children:N>9?"9+":N})]})}),e.jsxs("div",{className:"w-full px-4 py-3 z-20 bg-white/80 backdrop-blur-xl border-t border-slate-200 pb-safe shrink-0 shadow-[0_-5px_20px_rgba(0,0,0,0.02)]",children:[T&&x&&e.jsx("div",{className:"max-w-3xl mx-auto mb-2 animate-slide-up",children:e.jsxs("div",{className:"flex items-center gap-3 bg-white p-2 rounded-2xl border border-slate-200 shadow-xl relative pr-8",children:[x.image?e.jsx("img",{src:x.image,className:"w-12 h-12 object-cover rounded-xl bg-slate-200 shrink-0"}):e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center shrink-0",children:e.jsx(U,{size:20,className:"text-slate-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 truncate",children:x.title}),e.jsx("p",{className:"text-[10px] text-slate-500 truncate",children:x.description||x.url})]}),e.jsx("button",{onClick:()=>{f(!1),$(null)},className:"absolute top-1 right-1 p-1 text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(F,{size:14})})]})}),g.banned&&e.jsx("div",{className:"max-w-3xl mx-auto mb-2 bg-red-50 border border-red-200 rounded-2xl p-4 text-center shadow-lg",children:e.jsxs("div",{className:"text-red-600 flex flex-col items-center",children:[e.jsx(ue,{size:20,className:"mb-1"}),e.jsx("span",{className:"font-bold text-xs",children:"Anda Sedang Diskors"}),e.jsxs("span",{className:"text-[10px] font-mono mt-1",children:[H.formatTimeLeft(g.remaining||0)," lagi"]})]})}),e.jsxs("div",{className:"max-w-3xl mx-auto flex items-end gap-2 bg-slate-100/50 border border-slate-200 p-1.5 rounded-[24px] focus-within:bg-white focus-within:border-blue-400 focus-within:ring-4 focus-within:ring-blue-100 transition-all",children:[e.jsx("textarea",{value:a,onChange:r=>c(r.target.value),onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),y())},placeholder:s?"Ketik pesan untuk komunitas...":"Login untuk bergabung...",disabled:!s||g.banned,className:"flex-1 bg-transparent border-none outline-none text-base md:text-sm px-4 py-3 min-h-[44px] max-h-[120px] resize-none placeholder:text-slate-400 no-scrollbar leading-relaxed",rows:1,style:{height:"auto"},onInput:r=>{const t=r.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"}}),e.jsx("button",{onClick:y,disabled:!s||!a.trim()||g.banned,className:`w-10 h-10 flex items-center justify-center rounded-full transition-all shadow-sm shrink-0 mb-[2px] active:scale-90 ${g.banned?"bg-slate-300 text-slate-500 cursor-not-allowed":"bg-[#0A1A2E] text-white hover:bg-slate-800 disabled:opacity-50 disabled:scale-100"}`,children:D?e.jsx(X,{size:18,className:"animate-spin"}):e.jsx(Z,{size:18,className:"ml-0.5"})})]})]})]})},Y=({user:s,type:i,onAction:o,index:a=0})=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-slate-200 shadow-sm flex items-center justify-between gap-3 animate-slide-up-fade hover-lift group",style:{animationDelay:`${a*50}ms`},children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-50 flex items-center justify-center shrink-0 border border-slate-100 text-slate-500 font-bold text-lg shadow-inner group-hover:bg-blue-50 group-hover:text-blue-600 transition-colors",children:s.nama.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-slate-800 text-sm truncate group-hover:text-blue-700 transition-colors",children:s.nama}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 mt-0.5",children:[e.jsx($e,{size:12,className:"text-slate-400"}),e.jsx("span",{className:"truncate max-w-[140px]",children:s.kampus||"Kampus tidak diketahui"})]}),s.jurusan&&e.jsx("p",{className:"text-[10px] text-slate-400 truncate mt-0.5",children:s.jurusan})]})]}),e.jsxs("div",{className:"shrink-0 flex gap-2",children:[(i==="discover"||i==="search"&&!s.friendStatus&&!s.isSelf)&&e.jsx("button",{onClick:()=>o(s.id_akun,"request"),className:"p-2.5 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-600 hover:text-white transition-all shadow-sm btn-press",title:"Tambah Teman",children:e.jsx(oe,{size:18})}),i==="incoming"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(s.id_akun,"accept"),className:"p-2.5 bg-green-50 text-green-600 rounded-xl hover:bg-green-600 hover:text-white transition-all shadow-sm btn-press",title:"Terima",children:e.jsx(he,{size:18})}),e.jsx("button",{onClick:()=>o(s.id_akun,"reject"),className:"p-2.5 bg-red-50 text-red-600 rounded-xl hover:bg-red-600 hover:text-white transition-all shadow-sm btn-press",title:"Tolak",children:e.jsx(F,{size:18})})]}),i==="outgoing"&&e.jsx("button",{onClick:()=>o(s.id_akun,"cancel"),className:"px-4 py-2 bg-slate-100 text-slate-500 rounded-xl text-xs font-bold hover:bg-slate-200 transition-colors btn-press",children:"Batal"}),(i==="friend"||i==="search"&&s.friendStatus==="accepted")&&e.jsx("span",{className:"text-xs font-bold text-green-600 bg-green-50 px-3 py-1.5 rounded-lg border border-green-100",children:"Teman"}),i==="search"&&s.friendStatus&&s.friendStatus!=="accepted"&&e.jsx("span",{className:"text-xs text-slate-400 bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200",children:"Pending"})]})]}),Ge=({currentUser:s,onBack:i,onUpdateUser:o,activeTabProp:a})=>{var E,v,K;const[c,b]=n.useState(""),[z,D]=n.useState([]),[w,x]=n.useState(!1),[$,T]=n.useState(!1),[f,g]=n.useState(null);n.useEffect(()=>{h()},[a]);const h=async()=>{var u;if((u=s==null?void 0:s.verifikasi)!=null&&u.id_akun){T(!0);try{const I=await(await fetch(`${W}/users/sync?id=${s.verifikasi.id_akun}`)).json();I.found&&I.user&&o(I.user)}catch(j){console.error("Sync failed:",j)}finally{T(!1)}}};n.useEffect(()=>{a==="pencarian"&&z.length===0&&A()},[a]);const A=async()=>{x(!0);try{const I=((await(await fetch(`${W}/users/discover`)).json()).results||[]).filter(l=>{var k;return l.id_akun!==s.verifikasi.id_akun&&!((k=s.friends)!=null&&k.some(y=>y.id_akun===l.id_akun))});D(I)}catch(u){console.error(u)}finally{x(!1)}},M=async u=>{var j;if(u.preventDefault(),!!c.trim()){x(!0),g(null);try{const l=await(await fetch(`${W}/users/search?q=${encodeURIComponent(c)}`)).json();if(l.found){const k=l.user.id_akun===s.verifikasi.id_akun,y=(j=s.friends)==null?void 0:j.find(r=>r.id_akun===l.user.id_akun);g({...l.user,isSelf:k,friendStatus:y?y.status:null})}else alert("Pengguna tidak ditemukan.")}catch{alert("Gagal mencari.")}finally{x(!1)}}},N=async(u,j)=>{x(!0);try{const l=await(await fetch(`${W}/friends/action`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:j,my_id:s.verifikasi.id_akun,target_id:u})})).json();l.success?(o(l.my_data),a==="pencarian"&&(D(k=>k.filter(y=>y.id_akun!==u)),g(null))):alert(l.error)}catch(I){console.error(I),alert("Gagal memproses permintaan.")}finally{x(!1)}},_=((E=s.friends)==null?void 0:E.filter(u=>u.status==="pending_incoming"))||[],R=((v=s.friends)==null?void 0:v.filter(u=>u.status==="pending_outgoing"))||[],L=((K=s.friends)==null?void 0:K.filter(u=>u.status==="accepted"))||[];return e.jsx("div",{className:"flex flex-col h-full bg-[#f8fafc] relative overflow-hidden page-enter",children:e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 relative scroll-light",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-0",children:e.jsx(ce,{className:"w-[300px] h-[300px] opacity-[0.03] animate-pulse"})}),a==="pencarian"&&e.jsxs("div",{className:"space-y-6 relative z-10 animate-fade-in",children:[e.jsxs("form",{onSubmit:M,className:"flex gap-2 group",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Q,{className:"absolute left-4 top-3.5 text-slate-400 transition-colors group-focus-within:text-blue-500",size:18}),e.jsx("input",{type:"text",placeholder:"Cari ID Akun atau No. WA...",value:c,onChange:u=>b(u.target.value),className:"w-full pl-11 pr-4 py-3 bg-white border border-slate-200 rounded-2xl text-sm focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all shadow-sm hover:shadow-md"})]}),e.jsx("button",{type:"submit",disabled:w,className:"bg-blue-600 text-white px-4 md:px-5 py-2 rounded-2xl hover:bg-blue-700 disabled:opacity-50 transition-all shadow-lg shadow-blue-600/20 active:scale-95",children:w?e.jsx(X,{className:"animate-spin",size:24}):e.jsx(Q,{size:24})})]}),f&&e.jsxs("div",{className:"bg-blue-50/50 p-6 rounded-3xl border border-blue-100 animate-pop-in",children:[e.jsxs("h3",{className:"text-xs font-bold text-blue-600 mb-4 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(Q,{size:12})," Hasil Pencarian"]}),e.jsx(Y,{user:f,type:"search",onAction:N})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-800 mb-4 flex items-center gap-2 px-1",children:[e.jsx(Ae,{size:18,className:"text-purple-500"})," Rekomendasi Peneliti"]}),e.jsxs("div",{className:"grid gap-3",children:[z.map((u,j)=>e.jsx(Y,{index:j,user:u,type:"discover",onAction:N},j)),z.length===0&&!w&&e.jsx("div",{className:"text-center py-12 px-4 opacity-50 bg-white border border-slate-200 border-dashed rounded-3xl",children:e.jsx("p",{className:"text-sm text-slate-400",children:"Belum ada rekomendasi saat ini."})})]})]})]}),a==="permintaan"&&e.jsxs("div",{className:"space-y-3 relative z-10 animate-fade-in",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-700 mb-2 px-1",children:"Permintaan Masuk"}),_.length===0?e.jsx("div",{className:"text-center py-16 text-slate-400 text-sm bg-white rounded-3xl border border-slate-200 border-dashed animate-pop-in",children:"Tidak ada permintaan pertemanan baru."}):_.map((u,j)=>e.jsx(Y,{index:j,user:u,type:"incoming",onAction:N},j))]}),a==="meminta"&&e.jsxs("div",{className:"space-y-3 relative z-10 animate-fade-in",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-700 mb-2 px-1",children:"Permintaan Terkirim"}),R.length===0?e.jsx("div",{className:"text-center py-16 text-slate-400 text-sm bg-white rounded-3xl border border-slate-200 border-dashed animate-pop-in",children:"Anda belum mengirim permintaan pertemanan."}):R.map((u,j)=>e.jsx(Y,{index:j,user:u,type:"outgoing",onAction:N},j))]}),a==="teman"&&e.jsxs("div",{className:"space-y-3 relative z-10 animate-fade-in",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-700 mb-2 px-1",children:"Daftar Teman"}),L.length===0?e.jsxs("div",{className:"text-center py-16 text-slate-400 text-sm bg-white rounded-3xl border border-slate-200 border-dashed animate-pop-in",children:[e.jsx(ie,{size:32,className:"mx-auto mb-3 opacity-20"}),"Belum ada teman. Yuk cari peneliti lain di tab Pencarian!"]}):L.map((u,j)=>e.jsx(Y,{index:j,user:u,type:"friend",onAction:N},j))]})]})})},Ve=({currentUser:s,onUpdateUser:i,subView:o,setSubView:a,activeFriend:c,setActiveFriend:b,inviteTab:z})=>{const[D,w]=n.useState([]),[x,$]=n.useState(""),[T,f]=n.useState(!1),[g,h]=n.useState(""),[A,M]=n.useState(null),[N,_]=n.useState(!1),[R,L]=n.useState({banned:!1}),E=n.useRef(0),v=n.useRef(null),K=n.useRef(null),u=n.useRef(null),I=((s==null?void 0:s.friends)||[]).filter(t=>t.status==="accepted").filter(t=>t.nama.toLowerCase().includes(g.toLowerCase()));n.useEffect(()=>{o==="chat"&&L(H.isBanned())},[o]),n.useEffect(()=>{const t=()=>{v.current&&clearInterval(v.current),v.current=setInterval(()=>y(!1),1e3)},d=()=>{document.hidden?v.current&&clearInterval(v.current):o==="chat"&&(c!=null&&c.room_id)&&(y(!1),t())};if(o==="chat"&&c&&c.room_id){w([]),E.current=0,y(!0),t(),document.addEventListener("visibilitychange",d);const m=setInterval(()=>{const S=Date.now()-864e5;w(p=>p.filter(C=>C.created_at>S))},6e4);return()=>{v.current&&clearInterval(v.current),clearInterval(m),document.removeEventListener("visibilitychange",d)}}return()=>{v.current&&clearInterval(v.current)}},[o,c]),n.useEffect(()=>{if(x){const t=x.match(/(https?:\/\/[^\s]+)/);if(t){const d=t[0];u.current&&clearTimeout(u.current),(!A||A.url!==d)&&(u.current=setTimeout(()=>l(d),800))}else _(!1),M(null)}else _(!1),M(null)},[x]);const l=async t=>{try{const m=await(await fetch(`${W}/meta?url=${encodeURIComponent(t)}`)).json();m.title&&(M(m),_(!0))}catch{}};n.useEffect(()=>{k()},[D]);const k=()=>{var t;return(t=K.current)==null?void 0:t.scrollIntoView({behavior:"smooth"})},y=async(t=!1)=>{if(c!=null&&c.room_id&&!(document.hidden&&!t))try{t&&f(!0);let d=`${W}/chat/private?room_id=${c.room_id}`;!t&&E.current>0&&(d+=`&after=${E.current}`);const S=await(await fetch(d)).json();if(S.results&&S.results.length>0){const p=S.results,C=p[p.length-1];C.created_at>E.current&&(E.current=C.created_at),w(P=>{const B=P.filter(O=>!O.isPending),J=new Set(B.map(O=>O.id)),G=Date.now()-24*60*60*1e3;return[...B,...p.filter(O=>!J.has(O.id)&&O.created_at>G)]})}}catch{}finally{t&&f(!1)}},r=async()=>{const t=H.isBanned();if(t.banned){L(t),alert(`AKUN DISKORS: ${H.formatTimeLeft(t.remaining||0)}.`);return}if(!x.trim()||!(c!=null&&c.room_id))return;const d=H.checkContent(x);if(!d.isSafe){const C=H.handleViolation();alert(`${d.reason}

${C}`);const P=H.isBanned();L(P),P.banned&&$("");return}const m=Date.now(),S={id:m,room_id:c.room_id,sender_id:s.verifikasi.id_akun,sender_name:s.identitas.nama,message:x,created_at:Date.now(),isPending:!0};w(C=>[...C,S]);const p=x;$(""),M(null),_(!1);try{await fetch(`${W}/chat/private`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:c.room_id,sender_id:s.verifikasi.id_akun,sender_name:s.identitas.nama,message:p})}),y(!1)}catch{alert("Gagal mengirim"),w(P=>P.filter(B=>B.id!==m)),$(p)}};return o==="invite"?e.jsx("div",{className:"h-full bg-slate-50",children:e.jsx(Ge,{currentUser:s,onBack:()=>a("list"),onUpdateUser:i,activeTabProp:z})}):o==="chat"&&c?e.jsxs("div",{className:"flex flex-col h-full bg-slate-100 relative",children:[e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-100 py-1 px-4 text-center absolute top-0 w-full z-10 opacity-90",children:e.jsxs("p",{className:"text-[9px] text-yellow-700 font-medium flex items-center justify-center gap-1",children:[e.jsx(le,{size:10})," Pesan otomatis terhapus setelah 24 jam."]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pt-8 space-y-3 bg-[#e5ddd5]/10 bg-[url('https://grainy-gradients.vercel.app/noise.svg')]",children:[T&&D.length===0?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(X,{className:"animate-spin text-slate-400"})}):D.length===0?e.jsx("div",{className:"text-center py-10 opacity-50",children:e.jsx("div",{className:"bg-white inline-block px-4 py-2 rounded-full text-xs text-slate-500 shadow-sm",children:"Mulai percakapan"})}):D.map((t,d)=>{const m=t.sender_id===s.verifikasi.id_akun;return e.jsx("div",{className:`flex ${m?"justify-end":"justify-start"} animate-pop-in`,children:e.jsxs("div",{className:`max-w-[75%] px-4 py-2 rounded-2xl text-sm shadow-sm relative ${m?"bg-blue-600 text-white rounded-tr-none":"bg-white text-slate-800 rounded-tl-none border border-slate-200"} ${t.isPending?"opacity-70":""}`,children:[e.jsx(fe,{text:t.message,isMe:m}),e.jsxs("div",{className:`flex items-center justify-end gap-1 mt-1 opacity-70 ${m?"text-blue-100":"text-slate-400"}`,children:[t.isPending&&e.jsx(xe,{size:10}),e.jsx("span",{className:"text-[9px]",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},t.id)}),e.jsx("div",{ref:K})]}),e.jsxs("div",{className:"w-full px-4 py-3 z-30 bg-slate-100/90 backdrop-blur-md border-t border-slate-200 pb-safe shrink-0",children:[N&&A&&e.jsx("div",{className:"max-w-3xl mx-auto mb-2 animate-slide-up",children:e.jsxs("div",{className:"flex items-center gap-3 bg-white p-2 rounded-2xl border border-slate-200 shadow-xl relative pr-8",children:[A.image?e.jsx("img",{src:A.image,className:"w-12 h-12 object-cover rounded-xl bg-slate-200 shrink-0"}):e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center shrink-0",children:e.jsx(U,{size:20,className:"text-slate-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 truncate",children:A.title}),e.jsx("p",{className:"text-[10px] text-slate-500 truncate",children:A.description||A.url})]}),e.jsx("button",{onClick:()=>{_(!1),M(null)},className:"absolute top-1 right-1 p-1 text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(F,{size:14})})]})}),R.banned&&e.jsx("div",{className:"max-w-3xl mx-auto mb-2 bg-red-50 border border-red-200 rounded-2xl p-4 text-center shadow-lg",children:e.jsxs("div",{className:"text-red-600 flex flex-col items-center",children:[e.jsx(ue,{size:20,className:"mb-1"}),e.jsx("span",{className:"font-bold text-xs",children:"Akun Diskors"}),e.jsx("span",{className:"text-[10px] font-mono",children:H.formatTimeLeft(R.remaining||0)})]})}),e.jsxs("div",{className:"max-w-3xl mx-auto flex items-end gap-2 bg-white border border-slate-200 p-2 pr-2 rounded-[28px] shadow-xl shadow-slate-200/50 focus-within:border-blue-400 focus-within:ring-4 focus-within:ring-blue-100 transition-all",children:[e.jsx("textarea",{value:x,onChange:t=>$(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),r())},placeholder:"Ketik pesan...",disabled:R.banned,className:"flex-1 bg-transparent border-none outline-none text-base md:text-sm px-4 py-3 min-h-[44px] max-h-[120px] resize-none placeholder:text-slate-400 no-scrollbar leading-relaxed",rows:1,style:{height:"auto"},onInput:t=>{const d=t.target;d.style.height="auto",d.style.height=d.scrollHeight+"px"}}),e.jsx("button",{onClick:r,disabled:!x.trim()||R.banned,className:`w-[42px] h-[42px] flex items-center justify-center rounded-full transition-all shadow-md shrink-0 mb-[1px] ${R.banned?"bg-slate-300 text-slate-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50"}`,children:e.jsx(Z,{size:18,className:"ml-0.5"})})]})]})]}):e.jsxs("div",{className:"flex flex-col h-full bg-white relative",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-white sticky top-0 z-10 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3.5 top-3 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Cari teman...",value:g,onChange:t=>h(t.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-50 transition-all"})]}),e.jsxs("button",{onClick:()=>a("invite"),className:"w-full flex items-center justify-center gap-2 p-3 bg-slate-900 text-white rounded-xl text-xs font-bold hover:bg-slate-800 transition-all shadow-lg shadow-slate-900/10 group",children:[e.jsx(oe,{size:16,className:"group-hover:scale-110 transition-transform"})," Tambah Teman Baru"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:I.length===0?e.jsxs("div",{className:"text-center py-12 px-6",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-3 text-slate-300",children:e.jsx(ze,{size:32})}),e.jsx("p",{className:"text-sm text-slate-500 font-medium",children:"Belum ada teman."})]}):I.map((t,d)=>e.jsxs("button",{onClick:()=>{b(t),a("chat")},className:"w-full flex items-center gap-3 p-3 rounded-2xl hover:bg-slate-50 transition-all group border border-transparent hover:border-slate-100 text-left animate-slide-up-fade",style:{animationDelay:`${d*50}ms`},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold text-lg border border-slate-200 group-hover:border-blue-200 group-hover:text-blue-600 transition-colors",children:t.nama.charAt(0).toUpperCase()}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("h4",{className:"font-bold text-slate-800 text-sm truncate group-hover:text-blue-700 transition-colors",children:t.nama}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"Baru saja"})]}),e.jsx("p",{className:"text-xs text-slate-500 truncate mt-0.5 flex items-center gap-1",children:t.kampus||"Peneliti"})]}),e.jsx("div",{className:"text-slate-300 group-hover:text-blue-500 transition-colors",children:e.jsx(Ee,{size:18})})]},t.id_akun))})]})},xt=({sections:s,activeSectionId:i,setActiveSectionId:o,handleAddSection:a,handleDeleteSection:c,updateActiveSection:b,activeSection:z,metadata:D,currentUser:w,onNavigate:x,initialMessage:$,onMessageConsumed:T,initialTab:f="ai",onReorderSections:g})=>{var d;const[h,A]=n.useState(f==="community"?"community":"ai"),[M,N]=n.useState(!1),[_,R]=n.useState("list"),[L,E]=n.useState(null),[v,K]=n.useState("pencarian"),[u,j]=n.useState(w);n.useEffect(()=>{j(w)},[w]);const[I,l]=n.useState("offline"),k=m=>{j(m),localStorage.setItem("skripsi_user",JSON.stringify(m))},y=m=>{x(m),N(!1)},r=()=>h==="ai"?"Alin Asisten Pintar":h==="community"?"Komunitas":h==="private"?_==="invite"?"Cari Teman":_==="chat"&&L?L.nama:"Pesan Pribadi":"SkripsiLab",t=((d=u==null?void 0:u.friends)==null?void 0:d.filter(m=>m.status==="pending_incoming").length)||0;return e.jsxs("div",{className:"flex h-[100dvh] w-full bg-slate-100 overflow-hidden text-slate-800 relative",children:[e.jsx("div",{className:`fixed inset-0 bg-slate-950/60 z-40 transition-opacity duration-300 md:hidden ${M?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>N(!1)}),e.jsx("div",{className:`fixed inset-y-0 left-0 z-50 w-[80vw] md:w-80 transform transition-transform duration-500 cubic-bezier(0.19, 1, 0.22, 1) shadow-2xl md:relative md:translate-x-0 md:shadow-none ${M?"translate-x-0":"-translate-x-full"}`,children:e.jsxs("div",{className:"h-full relative",children:[e.jsx("button",{onClick:()=>N(!1),className:"absolute top-4 right-4 text-slate-400 md:hidden z-50 btn-press",children:e.jsx(F,{size:24})}),e.jsx(ke,{sections:s,activeSectionId:i,setActiveSectionId:o,handleAddSection:a,handleDeleteSection:c,updateActiveSection:b,onReorderSections:g,activeSectionTitle:z.title,activeView:h==="ai"?"chat":"chat-global",onNavigate:y})]})}),e.jsxs("div",{className:"flex-1 flex flex-col h-full bg-white relative w-full transition-all duration-300",children:[e.jsxs("div",{className:"h-16 border-b border-slate-200 flex items-center justify-between px-4 md:px-6 shadow-sm z-30 bg-white/90 backdrop-blur-md shrink-0 flex-none",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h==="private"&&(_==="invite"||_==="chat")?e.jsx("button",{onClick:()=>R("list"),className:"p-2 -ml-2 hover:bg-slate-100 rounded-full text-slate-600 transition-colors btn-press",children:e.jsx(Te,{size:20})}):e.jsx("button",{onClick:()=>N(!0),className:"md:hidden text-slate-500 hover:bg-slate-100 p-2 rounded-lg -ml-2 btn-press",children:e.jsx(Se,{size:20})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-800 text-sm md:text-base leading-tight tracking-tight",children:r()}),h==="ai"?e.jsxs("div",{className:"flex items-center gap-1.5 transition-all duration-500",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${I==="offline"?"bg-slate-300":"bg-green-500 shadow-[0_0_5px_#22c55e]"} ${I==="typing"?"animate-pulse":""}`}),e.jsx("span",{className:`text-[10px] font-medium ${I==="offline"?"text-slate-400":"text-green-600"}`,children:I==="offline"?"Offline":I==="typing"?"Mengetik...":"Online"})]}):e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:h==="community"?"SkripsiLabs Community":h==="private"&&_==="invite"?"Temukan teman diskusi":h==="private"&&_==="chat"&&L?L.kampus||"Peneliti":"SkripsiLabs Private"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:h==="private"&&_==="invite"?e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl shrink-0 gap-1 animate-scale-in",children:[e.jsx("button",{onClick:()=>K("pencarian"),className:`w-9 h-9 flex items-center justify-center rounded-lg transition-all ${v==="pencarian"?"bg-white text-blue-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,title:"Cari",children:e.jsx(Q,{size:18})}),e.jsxs("button",{onClick:()=>K("permintaan"),className:`w-9 h-9 flex items-center justify-center rounded-lg transition-all relative ${v==="permintaan"?"bg-white text-blue-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,title:"Masuk",children:[e.jsx(he,{size:18}),t>0&&e.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full ring-1 ring-white"})]}),e.jsx("button",{onClick:()=>K("meminta"),className:`w-9 h-9 flex items-center justify-center rounded-lg transition-all ${v==="meminta"?"bg-white text-blue-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,title:"Terkirim",children:e.jsx(Z,{size:18})}),e.jsx("button",{onClick:()=>K("teman"),className:`w-9 h-9 flex items-center justify-center rounded-lg transition-all ${v==="teman"?"bg-white text-blue-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,title:"Teman",children:e.jsx(ie,{size:18})})]}):e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl shrink-0 gap-1",children:[e.jsx("button",{onClick:()=>A("ai"),className:`flex items-center justify-center w-10 h-9 rounded-lg transition-all duration-300 ${h==="ai"?"bg-white text-blue-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,title:"AI Chat",children:e.jsx(Re,{size:18})}),e.jsx("button",{onClick:()=>A("community"),className:`flex items-center justify-center w-10 h-9 rounded-lg transition-all duration-300 ${h==="community"?"bg-white text-purple-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,title:"Komunitas Global",children:e.jsx(U,{size:18})}),e.jsx("button",{onClick:()=>A("private"),className:`flex items-center justify-center w-10 h-9 rounded-lg transition-all duration-300 ${h==="private"?"bg-white text-indigo-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,title:"Chat Teman",children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{size:18}),t>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-slate-100"})]})})]})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[h==="ai"&&e.jsx(Oe,{metadata:D,currentUser:u,initialMessage:$,onMessageConsumed:T,onStatusChange:l}),h==="community"&&e.jsx(We,{currentUser:u}),h==="private"&&e.jsx(Ve,{currentUser:u,onUpdateUser:k,subView:_,setSubView:R,activeFriend:L,setActiveFriend:E,inviteTab:v})]})]})]})};export{xt as MainChat};
